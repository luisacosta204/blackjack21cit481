<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Blackjack 21 — Profile</title>
    <meta name="description" content="User profile for Blackjack 21" />
    <!-- Fonts & Global Styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/style.css" />
    <link rel="stylesheet" href="assets/header-user.css">
</head>
<body>
    <header class="header">
        <nav class="nav container">
            <div class="left user-info">
                <img id="headerAvatar" src="assets/avatars/1.png" alt="User avatar">
                <span id="headerUsername" class="username"></span>
            </div>

            <div class="right">
                <a href="home.html" class="btn btn-secondary">Home</a>
                <a href="leaderboard.html" class="btn btn-secondary">Leaderboards</a>
            </div>
        </nav>
    </header>

    <main class="container stack" style="min-height:80vh; padding-top:24px;">
        <section class="panel stack">
            <div class="cluster" style="align-items:center; justify-content:space-between;">

                <div class="cluster" style="align-items:center;">
                    <!-- avatar block -->
                    <button id="avatarBtn" class="avatar-btn" aria-haspopup="true" aria-expanded="false" aria-controls="avatarPicker">
                        <img id="avatarImg" src="assets/avatars/1.png" alt="Your avatar" />
                    </button>

                    <!-- Avatar picker popover (single instance) -->
                    <div id="avatarPicker" class="avatar-picker" role="dialog" aria-modal="true" aria-labelledby="avatarPickerTitle" hidden>
                        <h3 id="avatarPickerTitle">Choose your avatar</h3>
                        <div class="avatar-grid">
                            <button type="button" class="avatar-option" data-src="assets/avatars/Flower.png">
                                <img src="assets/avatars/Flower.png" alt="Flower" />
                            </button>
                            <button type="button" class="avatar-option" data-src="assets/avatars/Hot Streak.png">
                                <img src="assets/avatars/Hot Streak.png" alt="Hot Streak" />
                            </button>
                            <button type="button" class="avatar-option" data-src="assets/avatars/robot.png">
                                <img src="assets/avatars/robot.png" alt="Robot" />
                            </button>
                            <button type="button" class="avatar-option" data-src="assets/avatars/silly_cat.png">
                                <img src="assets/avatars/silly_cat.png" alt="Kitty" />
                            </button>
                            <button type="button" class="avatar-option" data-src="assets/avatars/galaxy_spade.png">
                                <img src="assets/avatars/galaxy_spade.png" alt="Spade Galaxy" />
                            </button>
                            <button type="button" class="avatar-option" data-src="assets/avatars/Dollarydoos.png">
                                <img src="assets/avatars/Dollarydoos.png" alt="Dollarydoos" />
                            </button>
                        </div>
                        <div class="avatar-actions">
                            <button id="avatarCancel" class="btn btn-ghost" type="button">Cancel</button>
                        </div>
                    </div>
                </div>

                <div class="cluster">
                    <a href="#" class="btn btn-secondary">Edit Profile</a>
                    <a href="#" class="btn btn-danger">Log Out</a>
                </div>
            </div>

            <div class="grid cols-3">
                <div class="panel">
                    <h3 class="panel-header">Overview</h3>
                    <p class="panel-subtle">Quick stats</p>
                    <div class="grid cols-3">
                        <div class="stack">
                            <strong>Games</strong>
                            <div>512</div>
                        </div>
                        <div class="stack">
                            <strong>Wins</strong>
                            <div>318</div>
                        </div>
                        <div class="stack">
                            <strong>Best Streak</strong>
                            <div>11</div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h3 class="panel-header">Recent Activity</h3>
                    <p class="panel-subtle">Last 5 sessions</p>
                    <table class="table">
                        <thead>
                            <tr><th>Date</th><th>Mode</th><th>Result</th><th>Score</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Today</td><td>Standard</td><td><span class="badge win">Win</span></td><td>420</td></tr>
                            <tr><td>Yesterday</td><td>Standard</td><td><span class="badge lose">Loss</span></td><td>180</td></tr>
                            <tr><td>2 days ago</td><td>High Roller</td><td><span class="badge win">Win</span></td><td>890</td></tr>
                            <tr><td>3 days ago</td><td>Standard</td><td><span class="badge lose">Loss</span></td><td>120</td></tr>
                            <tr><td>4 days ago</td><td>Standard</td><td><span class="badge win">Win</span></td><td>370</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="panel">
                    <h3 class="panel-header">Account</h3>
                    <p class="panel-subtle">Settings</p>
                    <div class="stack">
                        <div class="cluster" style="justify-content:space-between;">
                            <div>Email</div>
                            <div>you@casino.com</div>
                        </div>
                        <div class="cluster" style="justify-content:space-between;">
                            <div>Two-Factor Auth</div>
                            <div><span class="badge">Off</span></div>
                        </div>
                        <div class="cluster" style="justify-content:space-between;">
                            <div>Newsletter</div>
                            <div><span class="badge">Subscribed</span></div>
                        </div>
                        <a href="#" class="btn btn-ghost">Manage Settings</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer container" style="text-align:center;">
        <p>© 2025 Blackjack 21. All rights reserved.</p>
    </footer>

    <script>
      // Shared header username + avatar
      (function () {
        const avatar = document.getElementById('headerAvatar');
        const usernameEl = document.getElementById('headerUsername');
        const storedName = localStorage.getItem('bj21.username');
        const storedAvatar = localStorage.getItem('bj21.avatar');
        const username = storedName || `Guest_${Math.floor(1000 + Math.random() * 9000)}`;
        usernameEl.textContent = username;
        localStorage.setItem('bj21.username', username);
        if (storedAvatar) avatar.src = storedAvatar;
        window.addEventListener('storage', (e) => {
          if (e.key === 'bj21.avatar' && e.newValue) { avatar.src = e.newValue; }
        });
      })();

      // Avatar picker behavior + header sync
      (function () {
        const btn = document.getElementById('avatarBtn');
        const img = document.getElementById('avatarImg');
        const panel = document.getElementById('avatarPicker');
        const cancel = document.getElementById('avatarCancel');
        const headerAvatar = document.getElementById('headerAvatar');

        let lastFocused = null;
        let transitionEndHandler = null;

        // Load saved avatar (if any)
        const saved = localStorage.getItem('bj21.avatar');
        if (saved) { img.src = saved; if (headerAvatar) headerAvatar.src = saved; }

        function getFocusable() {
          return panel.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        }
        function trapTab(e) {
          if (e.key !== 'Tab') return;
          const focusables = getFocusable();
          if (!focusables.length) return;
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
          else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
        }
        function onKeyDown(e) { if (e.key === 'Escape') { e.preventDefault(); closePanel(); return; } trapTab(e); }
        function onDocClick(e) { if (panel.hidden) return; if (panel.contains(e.target) || btn.contains(e.target)) return; closePanel(); }
        function positionPanel() {
          const rect = btn.getBoundingClientRect();
          panel.style.top = `${window.scrollY + rect.bottom + 8}px`;
          panel.style.left = `${window.scrollX + rect.left - 8}px`;
        }
        function openPanel() {
          if (!panel.hidden) return;
          lastFocused = document.activeElement instanceof HTMLElement ? document.activeElement : null;
          panel.hidden = false; positionPanel(); requestAnimationFrame(() => panel.classList.add('is-open'));
          btn.setAttribute('aria-expanded', 'true');
          document.addEventListener('click', onDocClick, { capture: true });
          document.addEventListener('keydown', onKeyDown);
          window.addEventListener('resize', onResize);
          const focusables = getFocusable(); if (focusables.length) focusables[0].focus();
        }
        function closePanel() {
          if (panel.hidden) return;
          btn.setAttribute('aria-expanded', 'false');
          panel.classList.remove('is-open');
          const hide = () => {
            panel.hidden = true;
            if (transitionEndHandler) { panel.removeEventListener('transitionend', transitionEndHandler); transitionEndHandler = null; }
          };
          let hid = false;
          const fallback = setTimeout(() => { if (!hid) { hide(); hid = true; } }, 200);
          transitionEndHandler = () => { if (!hid) { hide(); hid = true; } clearTimeout(fallback); };
          panel.addEventListener('transitionend', transitionEndHandler);
          document.removeEventListener('click', onDocClick, { capture: true });
          document.removeEventListener('keydown', onKeyDown);
          window.removeEventListener('resize', onResize);
          if (lastFocused) lastFocused.focus();
        }
        function togglePanel() { if (panel.hidden) openPanel(); else closePanel(); }
        function onResize() { if (!panel.hidden) positionPanel(); }
        btn.addEventListener('click', (e) => { e.preventDefault(); togglePanel(); });
        cancel.addEventListener('click', (e) => { e.preventDefault(); closePanel(); });

        panel.querySelectorAll('.avatar-option').forEach((opt) => {
          opt.addEventListener('click', (e) => {
            e.preventDefault();
            const src = opt.getAttribute('data-src');
            img.src = src;
            localStorage.setItem('bj21.avatar', src);
            if (headerAvatar) headerAvatar.src = src; // live update header
            closePanel();
          });
        });
      })();
    </script>
</body>
</html>